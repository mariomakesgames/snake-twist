# 障碍物系统 (Obstacle System)

这个系统为贪吃蛇游戏添加了随机生成的障碍物，增加游戏的挑战性和趣味性。

## 功能特性

- **单一大型障碍物**: 每局游戏只生成一个大的、粗的、从左上角开始的障碍物
- **多种字母形状**: 支持L、T、S、Z、M等字母形状的大型障碍物
- **左上角起始**: 所有障碍物都从左上角开始，延伸到地图边缘
- **智能避让**: 障碍物不会生成在蛇的出生区域（中心4格半径）
- **碰撞检测**: 蛇碰到障碍物会导致游戏结束
- **食物避让**: 食物不会生成在障碍物上
- **平衡设计**: 简单模式出现概率更高，确保游戏可玩性

## 障碍物类型

### 1. 简单模式 (Simple Pattern) - 推荐模式
- 生成1个超大型居中障碍物
- 包含：8x8方块(64块)、10x6矩形(60块)、超大L型(20块)、超大T型(24块)、超大十字(25块)
- 30%的出现概率，适合新手玩家
- 提供适度的挑战性

### 2. L型障碍物 (L-Shape Pattern)
- 生成1个大型L型障碍物，从左上角开始
- 3格厚度，垂直部分延伸到地图底部，水平部分向右延伸
- 从网格位置(3,2)开始，占据地图40%宽度
- 10%的出现概率

### 3. T型障碍物 (T-Shape Pattern)
- 生成1个大型T型障碍物，从左上角开始
- 3格厚度，垂直部分延伸到地图底部，水平部分在中间向右延伸
- 从网格位置(3,2)开始，占据地图40%宽度
- 10%的出现概率

### 4. S型障碍物 (S-Shape Pattern)
- 生成1个大型S型障碍物，从左上角开始
- 3格厚度，形成S形状的曲线路径
- 从网格位置(3,2)开始，占据地图40%宽度
- 10%的出现概率

### 5. Z型障碍物 (Z-Shape Pattern)
- 生成1个大型Z型障碍物，从左上角开始
- 3格厚度，形成Z形状的直线和斜线组合
- 从网格位置(3,2)开始，占据地图40%宽度
- 10%的出现概率

### 6. M型障碍物 (M-Shape Pattern)
- 生成1个大型M型障碍物，从左上角开始
- 3格厚度，形成M形状的双垂直线和斜线连接
- 从网格位置(3,2)开始，占据地图40%宽度
- 10%的出现概率

### 7. 迷宫型障碍物 (Maze Pattern)
- 创建1个大型迷宫结构，居中放置
- 走廊宽度为3格，墙壁厚度为2格
- 20x25格的大型迷宫区域
- 添加8个随机内部墙壁增加复杂性
- 10%的出现概率

### 8. 随机超大形状障碍物 (Random Pattern)
- 生成1个超大型随机形状，居中放置
- 包含：10x10方块(100块)、12x8矩形(96块)、超大L型(40块)、超大T型(50块)、超大十字(41块)
- 完全随机的形状组合
- 适合中等难度游戏
- 10%的出现概率

## 系统架构

### 核心类

1. **Obstacle**: 单个障碍物块
   - 位置、外观、物理属性
   - 碰撞检测

2. **ObstaclePattern**: 障碍物模式基类
   - 抽象类，定义障碍物生成接口
   - 提供位置验证和网格转换功能

3. **ObstacleManager**: 障碍物管理器
   - 管理所有障碍物
   - 加权随机选择模式并生成障碍物
   - 处理碰撞检测

### 模式实现

- `SimplePattern`: 简单型障碍物生成（推荐）
- `LShapePattern`: L型障碍物生成
- `TShapePattern`: T型障碍物生成
- `SShapePattern`: S型障碍物生成
- `ZShapePattern`: Z型障碍物生成
- `MShapePattern`: M型障碍物生成
- `MazePattern`: 迷宫型障碍物生成
- `RandomPattern`: 随机型障碍物生成

## 集成方式

1. **场景集成**: 在SnakeScene中初始化ObstacleManager
2. **游戏重启**: 每次重新开始游戏时重新生成障碍物
3. **食物避让**: 修改Food类，确保食物不会生成在障碍物上
4. **碰撞处理**: 蛇碰到障碍物触发游戏结束

## 使用方法

```typescript
// 在SnakeScene中初始化
this.obstacleManager = new ObstacleManager(this);
this.obstacleManager.generateObstacles();

// 重新开始游戏时重新生成
this.obstacleManager.generateObstacles();
```

## 配置选项

- **网格大小**: 20像素（与游戏网格一致）
- **障碍物颜色**: 灰色 (#666666)
- **生成区域**: 避开蛇的出生区域（中心4格半径）
- **最大尝试次数**: 防止无限循环
- **模式权重**: 简单模式30%，其他模式各10%

## 平衡性设计

- **单一大型障碍物**: 每局游戏只有一个大型障碍物，避免过于复杂
- **左上角起始**: 所有字母形状障碍物都从左上角开始，提供一致的体验
- **简单模式优先**: 30%概率出现，确保新手友好
- **保护区域**: 扩大蛇出生区域保护范围
- **渐进难度**: 从简单到复杂的不同模式

## 扩展性

系统设计为可扩展的，可以轻松添加新的障碍物模式：

1. 继承`ObstaclePattern`类
2. 实现`generate()`和`getName()`方法
3. 在`ObstacleManager`中注册新模式
4. 调整权重分配

## 性能考虑

- 使用网格对齐减少计算复杂度
- 限制最大尝试次数防止无限循环
- 高效的碰撞检测使用Phaser物理引擎
- 优化的模式选择算法 
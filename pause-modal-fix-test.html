<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ Snake Game - Pause Modal ä¿®å¤æµ‹è¯•</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        
        .test-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            backdrop-filter: blur(10px);
        }
        
        .test-steps {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .status {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .status ul {
            margin: 10px 0;
            padding-left: 20px;
        }
        
        .status li {
            margin: 5px 0;
        }
        
        #game-container {
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            overflow: hidden;
            background: #000;
        }
        
        .test-controls {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .test-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            font-size: 14px;
        }
        
        .test-button:hover {
            background: #45a049;
        }
        
        .test-button.danger {
            background: #f44336;
        }
        
        .test-button.danger:hover {
            background: #da190b;
        }
        
        .log-container {
            background: rgba(0, 0, 0, 0.8);
            color: #00ff00;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="test-info">
        <h1>ğŸ Snake Game - Pause Modal ä¿®å¤æµ‹è¯•</h1>
        <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•å¤šæ¬¡åˆ‡æ¢tabæ—¶pause modalé‡å¤åˆ›å»ºçš„é—®é¢˜æ˜¯å¦å·²ä¿®å¤ã€‚</p>
        
        <div class="test-steps">
            <h3>æµ‹è¯•æ­¥éª¤ï¼š</h3>
            <ol>
                <li>å¼€å§‹æ¸¸æˆï¼Œè®©è›‡å¼€å§‹ç§»åŠ¨</li>
                <li>å¿«é€Ÿåˆ‡æ¢tabï¼ˆAlt+Tabæˆ–ç‚¹å‡»å…¶ä»–çª—å£ï¼‰</li>
                <li>è§‚å¯Ÿæ˜¯å¦åªæ˜¾ç¤ºä¸€ä¸ªpause modal</li>
                <li>ä½¿ç”¨æµ‹è¯•æŒ‰é’®æ¨¡æ‹Ÿå¿«é€Ÿåˆ‡æ¢</li>
                <li>æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—ç¡®è®¤æ²¡æœ‰é‡å¤åˆ›å»º</li>
            </ol>
        </div>
        
        <div class="status">
            <strong>é¢„æœŸç»“æœï¼š</strong>
            <ul>
                <li>âœ… å¤šæ¬¡åˆ‡æ¢tabåªæ˜¾ç¤ºä¸€ä¸ªpause modal</li>
                <li>âœ… æ²¡æœ‰é‡å¤çš„overlayå…ƒç´ </li>
                <li>âœ… æ§åˆ¶å°æ²¡æœ‰é‡å¤çš„åˆ›å»ºæ—¥å¿—</li>
                <li>âœ… ç‚¹å‡»å±å¹•å¯ä»¥æ­£å¸¸æ¢å¤æ¸¸æˆ</li>
            </ul>
        </div>
    </div>

    <div class="test-controls">
        <h3>æµ‹è¯•æ§åˆ¶ï¼š</h3>
        <button class="test-button" onclick="simulateTabSwitch()">æ¨¡æ‹ŸTabåˆ‡æ¢</button>
        <button class="test-button" onclick="simulateRapidSwitches()">æ¨¡æ‹Ÿå¿«é€Ÿåˆ‡æ¢</button>
        <button class="test-button" onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
        <button class="test-button danger" onclick="resetGame()">é‡ç½®æ¸¸æˆ</button>
    </div>

    <div class="log-container" id="logContainer">
        <div>ç­‰å¾…æµ‹è¯•å¼€å§‹...</div>
    </div>

    <div id="game-container">
        <!-- æ¸¸æˆå°†åœ¨è¿™é‡ŒåŠ è½½ -->
    </div>

    <script>
        // æ—¥å¿—åŠŸèƒ½
        function log(message) {
            const logContainer = document.getElementById('logContainer');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.textContent = `[${timestamp}] ${message}`;
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            console.log(message);
        }

        function clearLog() {
            const logContainer = document.getElementById('logContainer');
            logContainer.innerHTML = '<div>æ—¥å¿—å·²æ¸…ç©º...</div>';
        }

        // æ¨¡æ‹Ÿtabåˆ‡æ¢
        function simulateTabSwitch() {
            log('æ¨¡æ‹ŸTabåˆ‡æ¢...');
            
            // æ¨¡æ‹Ÿé¡µé¢éšè—
            Object.defineProperty(document, 'hidden', {
                writable: true,
                value: true
            });
            
            // è§¦å‘visibilitychangeäº‹ä»¶
            document.dispatchEvent(new Event('visibilitychange'));
            
            // å»¶è¿Ÿåæ¨¡æ‹Ÿé¡µé¢æ˜¾ç¤º
            setTimeout(() => {
                Object.defineProperty(document, 'hidden', {
                    writable: true,
                    value: false
                });
                document.dispatchEvent(new Event('visibilitychange'));
                log('Tabåˆ‡æ¢æ¨¡æ‹Ÿå®Œæˆ');
            }, 500);
        }

        // æ¨¡æ‹Ÿå¿«é€Ÿåˆ‡æ¢
        function simulateRapidSwitches() {
            log('å¼€å§‹æ¨¡æ‹Ÿå¿«é€Ÿåˆ‡æ¢...');
            
            let count = 0;
            const maxCount = 5;
            
            const rapidSwitch = () => {
                if (count >= maxCount) {
                    log('å¿«é€Ÿåˆ‡æ¢æ¨¡æ‹Ÿå®Œæˆ');
                    return;
                }
                
                count++;
                log(`å¿«é€Ÿåˆ‡æ¢ ${count}/${maxCount}`);
                
                // å¿«é€Ÿåˆ‡æ¢
                Object.defineProperty(document, 'hidden', {
                    writable: true,
                    value: true
                });
                document.dispatchEvent(new Event('visibilitychange'));
                
                setTimeout(() => {
                    Object.defineProperty(document, 'hidden', {
                        writable: true,
                        value: false
                    });
                    document.dispatchEvent(new Event('visibilitychange'));
                    
                    // ç»§ç»­ä¸‹ä¸€æ¬¡åˆ‡æ¢
                    setTimeout(rapidSwitch, 200);
                }, 100);
            };
            
            rapidSwitch();
        }

        // é‡ç½®æ¸¸æˆ
        function resetGame() {
            log('é‡ç½®æ¸¸æˆ...');
            const gameState = window.gameState;
            if (gameState) {
                gameState.isPaused = false;
                gameState.isGameOver = false;
            }
            
            // é‡æ–°åŠ è½½é¡µé¢
            location.reload();
        }

        // ç›‘å¬visibility changeäº‹ä»¶
        const originalVisibilityChange = document.addEventListener;
        document.addEventListener = function(type, listener, options) {
            if (type === 'visibilitychange') {
                log('æ£€æµ‹åˆ°visibilitychangeäº‹ä»¶ç›‘å¬å™¨æ³¨å†Œ');
            }
            return originalVisibilityChange.call(this, type, listener, options);
        };

        // ç›‘å¬æ¸¸æˆçŠ¶æ€å˜åŒ–
        const originalConsoleLog = console.log;
        console.log = function(...args) {
            const message = args.join(' ');
            if (message.includes('é¡µé¢éšè—') || message.includes('è‡ªåŠ¨æš‚åœ') || 
                message.includes('createPauseOverlay') || message.includes('removePauseOverlay')) {
                log(`æ¸¸æˆæ—¥å¿—: ${message}`);
            }
            originalConsoleLog.apply(console, args);
        };

        // é¡µé¢åŠ è½½å®Œæˆ
        window.addEventListener('load', () => {
            log('æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
            log('å¼€å§‹ç›‘å¬æ¸¸æˆäº‹ä»¶...');
        });
    </script>

    <!-- åŠ è½½æ¸¸æˆ -->
    <script type="module" src="/src/main.tsx"></script>
</body>
</html> 